var vm;$(function(){$("#search").change(function(){$("#bookmarks").empty();loadVue();dumpBookmarks($("#search").val())});$("#lmfw").on("click","i",function(){if($(this).attr("data-url")){chrome.tabs.create({url:$(this).attr("data-url")})}})});var TreeNodesList=[];var isCreating=true;function dumpBookmarks(b){var a=chrome.bookmarks.getTree(function(c){TreeNodesList=dumpTreeNodes(c,b);if(isCreating){loadVue();isCreating=false}hide_child(TreeNodesList[0])});return TreeNodesList[0]}function hide_child(b){b.visible=false;for(var a=0;a<b.children.length;a++){if((typeof b.children[a]["children"]!="undefined")&&(b.children[a]["children"].length>0)){hide_child(b.children[a])}if(b.children[a]["visible"]){b.visible=true}}return true}function dumpTreeNodes(c,e){var d=[];var b;var a;for(b=0;b<c.length;b++){a=dumpNode(c[b],e);if(a){d.push(a)}}return d}var top=[];function dumpNode(e,g){if(!e.title){if(e.url){e.title=e.url}}if(!e.url){e.url=false}var c=$("<a>");c.attr("href",e.url);c.text(e.title);c.click(function(){chrome.tabs.create({url:e.url})});var d=$("<span>");var b=e.children?$('<span>[<a href="#" id="addlink">Add</a>]</span>'):$('<span>[<a id="editlink" href="#">Edit</a> <a id="deletelink" href="#">Delete</a>]</span>');var f=e.children?$('<table><tr><td>Name</td><td><input id="title"></td></tr><tr><td>URL</td><td><input id="url"></td></tr></table>'):$("<input>");d.hover(function(){d.append(b);$("#deletelink").click(function(){$("#deletedialog").empty().dialog({autoOpen:false,title:"Confirm Deletion",resizable:false,height:140,modal:true,overlay:{backgroundColor:"#000",opacity:0.5},buttons:{"Yes, Delete It!":function(){chrome.bookmarks.remove(String(e.id));d.parent().remove();$(this).dialog("destroy")},Cancel:function(){$(this).dialog("destroy")}}}).dialog("open")});$("#addlink").click(function(){$("#adddialog").empty().append(f).dialog({autoOpen:false,closeOnEscape:true,title:"Add New Bookmark",modal:true,buttons:{Add:function(){chrome.bookmarks.create({parentId:e.id,title:$("#title").val(),url:$("#url").val()});$("#bookmarks").empty();$(this).dialog("destroy");window.dumpBookmarks()},Cancel:function(){$(this).dialog("destroy")}}}).dialog("open")});$("#editlink").click(function(){f.val(c.text());$("#editdialog").empty().append(f).dialog({autoOpen:false,closeOnEscape:true,title:"Edit Title",modal:true,show:"slide",buttons:{Save:function(){chrome.bookmarks.update(String(e.id),{title:f.val()});c.text(f.val());b.show();$(this).dialog("destroy")},Cancel:function(){$(this).dialog("destroy")}}}).dialog("open")});b.fadeIn()},function(){b.remove()}).append(c);var a=[];if(e.children&&e.children.length>0){a={id:e.id,name:e.title,link:e.url,visible:true,children:dumpTreeNodes(e.children,g)}}else{if((g)&&((String(e.title).indexOf(g)==-1)&&(String(e.url).indexOf(g)==-1))){a={id:e.id,name:e.title,link:e.url,visible:false}}else{a={id:e.id,name:e.title,link:e.url,visible:true}}}return a}function createChild(a){chrome.bookmarks.create({parentId:a,title:"new stuff",url:"http://new-link.com"},function(b){console.log(b.id);var c=b.id;return c})}document.addEventListener("DOMContentLoaded",function(){dumpBookmarks()});function loadVue(){Vue.component("item",{template:"#item-template",props:{model:Object,treeData:Object},data:function(){return{open:false}},computed:{isFolder:function(){return this.model.children&&this.model.children.length},isVisible:function(){return(this.model.visible)},isOpen:function(){if(this.isFolder){if(this.open){return false}else{return true}}return false},treeData:TreeNodesList[0]},methods:{toggle:function(){if(this.isFolder){this.open=!this.open}},gotActiveChild:function(){visible=false;if((this.model.children.length>1)){visible=true}return visible},addChild:function(){this.model.children.push({id:createChild(this.model.id),name:"new stuff",link:"http://new-link.com",visible:true})},removeChild:function(){if(this.isFolder){chrome.bookmarks.removeTree(this.model.id)}else{chrome.bookmarks.remove(this.model.id)}this.model=null}}});vm=new Vue({el:"#lmfw",data:{treeData:TreeNodesList[0]},methods:{reload:function(){this.treeData=dumpBookmarks($("#search").val());console.log(this.treeData)}}})};